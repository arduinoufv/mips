!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("wavecanvas",[],e):"object"==typeof exports?exports.wavecanvas=e():t.wavecanvas=e()}(this,function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.Vector3vl=i.Vector3vl;function r(t){let e=t.gridStep;for(;e*t.pixelsPerTick<t.gridMinDist;)10*e*t.pixelsPerTick<t.gridMinDist?e*=10:2*e*t.pixelsPerTick>=t.gridMinDist?e*=2:5*e*t.pixelsPerTick>=t.gridMinDist?e*=5:e*=10;return e}e.Waveform=class{constructor(t,e=[]){this._bits=t,this._data=e,0==e.length?this._present=-1:this._present=this._data[this._data.length-1][0]}get bits(){return this._bits}updatePresent(t){this._present=Math.max(this._present,t)}push(t,e){if(console.assert(e.bits==this._bits&&t>=this._present),this._present=t,this._data.length>0){const[s,i]=this._data[this._data.length-1];if(i.eq(e))return;if(console.assert(t>=s),t==s)return void(this._data[this._data.length-1][1]=e)}this._data.push([t,e])}getRange(t,e){if(0==this._data.length)return[];const s=t=>{let e=0,s=this._data.length;for(;s>e;){const i=e+s>>1,r=this._data[i][0];if(t==r)return i;t<r?s=i:e=i+1}return e==this._data.length?e-1:e};let i=s(t),r=s(t+e);i>0&&this._data[i][0]>t&&i--,r<this._data.length-1&&this._data[r][0]<t+e&&r++;const n=this._data.slice(i,r+1).map(t=>[t[0],t[1]]);return n[n.length-1][0]<t+e&&this._present>n[n.length-1][0]&&n.push([this._present,n[n.length-1][1]]),n}},e.defaultSettings={start:0,pixelsPerTick:10,bitColors:["#fc7c68","#999","#03c03c","#779ecb"],gapScale:.2,heightFill:.8,base:"hex",gridWidth:.5,gridColor:"gray",gridStep:1,gridMinDist:10,font:"10px sans-serif"},Object.freeze(e.defaultSettings),e.extendSettings=function(t,e){var s={};for(const[t,i]of Object.entries(e))s[t]={value:i,writable:!0};return Object.create(t,s)},e.calcGridStep=r,e.drawWaveform=function(t,e,s){const i=(t,e)=>{switch(e){case"bin":return t.toBin();case"hex":return t.toHex();case"oct":return t.toOct()}};e.clearRect(0,0,e.canvas.width,e.canvas.height);const n=e.canvas.width/s.pixelsPerTick;"present"in s&&t.updatePresent(s.present);const o=t.getRange(s.start,Math.ceil(n)),c=o.map((t,e)=>[t,o[e+1]]);c.pop();const a=t=>(Math.max(Math.min(t,s.start+n),s.start)-s.start)*s.pixelsPerTick,h=.5*e.canvas.height,l=(.5-s.heightFill/2)*e.canvas.height,_=(.5+s.heightFill/2)*e.canvas.height,u=t=>[_,h,l][t+1],b=t=>s.bitColors[t+1],v=t=>s.bitColors[t.isDefined?t.isLow?0:t.isHigh?2:3:1],f=e.createLinearGradient(0,_,0,l);f.addColorStop(0,s.bitColors[0]),f.addColorStop(.5,s.bitColors[1]),f.addColorStop(1,s.bitColors[2]),e.lineWidth=s.gridWidth;const g=r(s);for(let t=s.start-s.start%g;t<s.start+n;t+=g){const i=a(t);e.beginPath(),e.strokeStyle=s.gridColor,e.moveTo(i,0),e.lineTo(i,e.canvas.height),e.stroke()}e.lineWidth=2;for(const[[r,n],[o,g]]of c){const c=a(r),p=a(o);if(1==t.bits){const t=n.get(0),i=g.get(0),r=u(t),o=u(i),a=b(t),h=(b(i),Math.min(Math.abs(r-o)*s.gapScale,s.pixelsPerTick/2));e.beginPath(),e.strokeStyle=f,e.moveTo(p-h,r),e.lineTo(p,o),e.stroke(),e.beginPath(),e.strokeStyle=a,e.moveTo(c,r),e.lineTo(p-h,r),e.stroke()}else{const t=Math.min(Math.abs(l-_)*s.gapScale,s.pixelsPerTick/2),r=v(n),o=v(g),a=n.isDefined,u=g.isDefined;if(a){e.textAlign="center",e.textBaseline="middle",e.font=s.font;const r=i(n,s.base);e.measureText(r).width<2*(p-c-t)&&e.fillText(i(n,s.base),(c+p-t)/2,e.canvas.height/2,p-c-t)}a||u?n.eq(g)?(e.strokeStyle=o,e.beginPath(),e.moveTo(c,l),e.lineTo(p,l),e.stroke(),e.beginPath(),e.moveTo(c,_),e.lineTo(p,_),e.stroke()):(e.strokeStyle=o,u?(e.beginPath(),e.moveTo(p,l),e.lineTo(p-t/2,h),e.lineTo(p,_),e.stroke()):(e.beginPath(),e.moveTo(p,h),e.lineTo(p-t/2,h),e.stroke()),e.strokeStyle=r,a?(e.beginPath(),e.moveTo(c,l),e.lineTo(p-t,l),e.lineTo(p-t/2,h),e.lineTo(p-t,_),e.lineTo(c,_),e.stroke()):(e.beginPath(),e.moveTo(c,h),e.lineTo(p-t/2,h),e.stroke())):(e.beginPath(),e.strokeStyle=r,e.moveTo(c,h),e.lineTo(p,h),e.stroke())}}}},function(t,e,s){"use strict";function i(t,e,s){return e.map((e,i)=>t(e,s[i]))}function r(t,e,s,i,r){return e.map((e,n)=>t(e,s[n],i[n],r[n]))}function n(t,e,s,i){if(0==e.length)return 1==i?1:0;let r=e[e.length-1];1==i?r|=~s:r&=s;for(let s=0;s<e.length-1;s++)r=t(r,e[s]);return r=t(r,r>>>16),r=t(r,r>>>8),r=t(r,r>>>4),r=t(r,r>>>2),1&(r=t(r,r>>>1))}function o(t){return 31&t}function c(t,e,s,i,r){const n=t>0&&!(i[e]&1<<t-1)&&r[e]&1<<t-1;n&&o(t)&&(r[e]|=-1<<t),n&&e+1<s&&r.fill(-1,e+1)}function a(t,e){const s={};return function i(r,n){if(s[r]=n,!(r.length*t>=e)){for(let e=0;e<1<<t;e+=1)i(r+e.toString(1<<t),n<<t|e|e<<16);i(r+"x",n<<t|(1<<t)-1)}}("",0),Object.seal(s),s}Object.defineProperty(e,"__esModule",{value:!0});const h=a(1,8),l=a(3,3),_=a(4,8);function u(t,e,s,i){const r=[];let n=0,o=t;for(;n<e;){const t="00000000"+s[o].toString(16),c=s[o]^i[o];o++;for(let s=0;s<8&&n<e;s++,n+=4)c&15<<4*s?r.push("x"):r.push(t[t.length-1-s])}return r.reverse().join("")}function b(t,e,s,i){const r=[];let n=0,o=t;for(;n<e;){const t="00000000000000000000000000000000"+s[o].toString(2),c=s[o]^i[o];o++;for(let s=0;s<32&&n<e;s++,n++)c&1<<s?r.push("x"):r.push(t[t.length-1-s])}return r.reverse().join("")}function v(t,e,s,i,r){const n=s+31>>>5;let a=0,h=-1+e;for(let e=t.length;e>0;){const s=t.slice(Math.max(0,e-2),e);e-=s.length;const n=_[s];0==o(a)&&h++;const c=(1<<4*s.length)-1;i[h]|=(n>>>16&c)<<a,r[h]|=(n&c)<<a,a+=4*s.length}a<s&&c(a,h,n,i,r)}function f(t,e,s,i,r){const n=s+31>>>5;let a=0,l=-1+e;for(let e=t.length;e>0;){const s=t.slice(Math.max(0,e-8),e);e-=s.length;const n=h[s];0==o(a)&&l++;const c=(1<<1*s.length)-1;i[l]|=(n>>>16&c)<<a,r[l]|=(n&c)<<a,a+=1*s.length}a<s&&c(a,l,n,i,r)}class g{constructor(t,e,s){this._bits=t,this._avec=e,this._bvec=s}static make(t,e){let s,i;switch(t|=0,e){case!0:case"1":case 1:s=i=-1;break;case!1:case"0":case-1:case void 0:s=i=0;break;case"x":case 0:s=0,i=-1;break;default:console.assert(!1)}const r=(t+31)/32|0;return new g(t,new Uint32Array(r).fill(s),new Uint32Array(r).fill(i))}static zeros(t){return g.make(t,-1)}static ones(t){return g.make(t,1)}static xes(t){return g.make(t,0)}static fromBool(t){return g.make(1,t?1:-1)}static concat(...t){const e=t.reduce((t,e)=>e.bits+t,0)+31>>>5;let s=0,i=-1,r=new Uint32Array(e),n=new Uint32Array(e);for(const c of t)if(c.normalize(),0==o(s))r.set(c._avec,i+1),n.set(c._bvec,i+1),s+=c._bits,i+=c._bits+31>>>5;else{for(const t in c._avec){if(r[i]|=c._avec[t]<<s,n[i]|=c._bvec[t]<<s,++i==e)break;r[i]=c._avec[t]>>>-s,n[i]=c._bvec[t]>>>-s}i+1>(s+=c._bits)+31>>>5&&i--}return new g(s,r,n)}static fromIterator(t,e,s){return 0==(e&e-1)?g.fromIteratorPow2(t,e,s):g.fromIteratorAnySkip(t,e,s)}static fromIteratorAnySkip(t,e,s){const i=s+31>>>5;let r=0,n=-1,a=new Uint32Array(i),h=new Uint32Array(i);const l=(1<<e)-1;for(const s of t)0==o(r)&&n++,a[n]|=(s>>>e&l)<<r,h[n]|=(s&l)<<r,l<<r>>>r!=l&&(a[++n]=(s>>>e&l)>>>-r,h[n]=(s&l)>>>-r),r+=e;return r<s&&c(r,n,i,a,h),new g(s,a,h)}static fromIteratorPow2(t,e,s){const i=s+31>>>5;let r=0,n=-1,a=new Uint32Array(i),h=new Uint32Array(i);const l=(1<<e)-1;for(const s of t)0==o(r)&&n++,a[n]|=(s>>>e&l)<<r,h[n]|=(s&l)<<r,r+=e;return r<s&&c(r,n,i,a,h),new g(s,a,h)}static fromArray(t){const e=t.length,s=e+31>>>5;let i=0,r=-1,n=new Uint32Array(s),a=new Uint32Array(s);for(const e of t){const t=e+1+Number(e>0);0==o(i)&&r++,n[r]|=(t>>>1&1)<<i,a[r]|=(1&t)<<i,i+=1}return i<e&&c(i,r,s,n,a),new g(e,n,a)}static fromBin(t,e){void 0===e&&(e=t.length);const s=e+31>>>5,i=new Uint32Array(s),r=new Uint32Array(s);return f(t,0,e,i,r),new g(e,i,r)}static fromOct(t,e){void 0===e&&(e=3*t.length);const s=e+31>>>5;let i=0,r=-1,n=new Uint32Array(s),a=new Uint32Array(s);for(let e=t.length-1;e>=0;e--){const s=l[t[e]];0==o(i)&&r++,n[r]|=(s>>>16&7)<<i,a[r]|=(7&s)<<i,7<<i>>>i!=7&&(n[++r]=(s>>>16&7)>>>-i,a[r]=(7&s)>>>-i),i+=3}return i<e&&c(i,r,s,n,a),new g(e,n,a)}static fromHex(t,e){void 0===e&&(e=4*t.length);const s=e+31>>>5,i=new Uint32Array(s),r=new Uint32Array(s);return v(t,0,e,i,r),new g(e,i,r)}get bits(){return this._bits}get msb(){return this.get(this._bits-1)}get lsb(){return this.get(0)}get(t){const e=o(t),s=function(t){return t>>5}(t);return(this._avec[s]>>>e&1)+(this._bvec[s]>>>e&1)-1}get isHigh(){if(0==this._bits)return!0;const t=this._lastmask,e=e=>e.slice(0,e.length-1).every(t=>0==~t)&&(e[e.length-1]&t)==t;return e(this._avec)&&e(this._bvec)}get isLow(){if(0==this._bits)return!0;const t=this._lastmask,e=e=>e.slice(0,e.length-1).every(t=>0==t)&&0==(e[e.length-1]&t);return e(this._avec)&&e(this._bvec)}get isDefined(){if(0==this._bits)return!1;const t=i((t,e)=>t^e,this._avec,this._bvec);return t[t.length-1]|=~this._lastmask,!t.every(t=>0==~t)}get isFullyDefined(){if(0==this._bits)return!0;const t=i((t,e)=>t^e,this._avec,this._bvec);return t[t.length-1]&=this._lastmask,!t.some(t=>Boolean(t))}and(t){return console.assert(t._bits==this._bits),new g(this._bits,i((t,e)=>t&e,t._avec,this._avec),i((t,e)=>t&e,t._bvec,this._bvec))}or(t){return console.assert(t._bits==this._bits),new g(this._bits,i((t,e)=>t|e,t._avec,this._avec),i((t,e)=>t|e,t._bvec,this._bvec))}xor(t){return console.assert(t._bits==this._bits),new g(this._bits,r((t,e,s,i)=>(t|s)&(e^i),t._avec,t._bvec,this._avec,this._bvec),r((t,e,s,i)=>t&s^(e|i),t._avec,t._bvec,this._avec,this._bvec))}nand(t){return console.assert(t._bits==this._bits),new g(this._bits,i((t,e)=>~(t&e),t._bvec,this._bvec),i((t,e)=>~(t&e),t._avec,this._avec))}nor(t){return console.assert(t._bits==this._bits),new g(this._bits,i((t,e)=>~(t|e),t._bvec,this._bvec),i((t,e)=>~(t|e),t._avec,this._avec))}xnor(t){return console.assert(t._bits==this._bits),new g(this._bits,r((t,e,s,i)=>~(t&s^(e|i)),t._avec,t._bvec,this._avec,this._bvec),r((t,e,s,i)=>~((t|s)&(e^i)),t._avec,t._bvec,this._avec,this._bvec))}not(){return new g(this._bits,this._bvec.map(t=>~t),this._avec.map(t=>~t))}xmask(){const t=i((t,e)=>t^e,this._avec,this._bvec);return new g(this._bits,t,t)}reduceAnd(){return new g(1,Uint32Array.of(n((t,e)=>t&e,this._avec,this._lastmask,1)),Uint32Array.of(n((t,e)=>t&e,this._bvec,this._lastmask,1)))}reduceOr(){return new g(1,Uint32Array.of(n((t,e)=>t|e,this._avec,this._lastmask,0)),Uint32Array.of(n((t,e)=>t|e,this._bvec,this._lastmask,0)))}reduceNand(){return new g(1,Uint32Array.of(~n((t,e)=>t&e,this._bvec,this._lastmask,1)),Uint32Array.of(~n((t,e)=>t&e,this._avec,this._lastmask,1)))}reduceNor(){return new g(1,Uint32Array.of(~n((t,e)=>t|e,this._bvec,this._lastmask,0)),Uint32Array.of(~n((t,e)=>t|e,this._avec,this._lastmask,0)))}reduceXor(){const t=n((t,e)=>t|e,i((t,e)=>~t&e,this._avec,this._bvec),this._lastmask,0),e=n((t,e)=>t^e,this._avec,this._lastmask,0);return new g(1,Uint32Array.of(e&~t),Uint32Array.of(e|t))}reduceXnor(){return this.reduceXor().not()}concat(...t){return g.concat(this,...t)}slice(t,e){if(void 0===t&&(t=0),void 0===e&&(e=this._bits),e>this.bits&&(e=this.bits),t>e&&(e=t),0==o(t)){const s=this._avec.slice(t>>>5,e+31>>>5),i=this._bvec.slice(t>>>5,e+31>>>5);return new g(e-t,s,i)}{const s=e-t+31>>>5,i=new Uint32Array(s),r=new Uint32Array(s);let n=0;i[n]=this._avec[t>>5]>>>t,r[n]=this._bvec[t>>5]>>>t;for(let o=1+(t>>5);o<=e>>>5&&(i[n]|=this._avec[o]<<-t,r[n]|=this._bvec[o]<<-t,++n!=s);o++)i[n]=this._avec[o]>>>t,r[n]=this._bvec[o]>>>t;return new g(e-t,i,r)}}toIterator(t){return 0==(t&t-1)?this.toIteratorPow2(t):this.toIteratorAnySkip(t)}*toIteratorAnySkip(t){this.normalize();const e=(1<<t)-1;let s=0,i=0,r=e;for(;s<this._bits;){let n=(this._avec[i]&r)>>>s,o=(this._bvec[i]&r)>>>s;if(r>>>s!=e&&i+1!=this._avec.length){const t=e>>-s;n|=(this._avec[i+1]&t)<<-s,o|=(this._bvec[i+1]&t)<<-s}yield n<<t|o,s+=t,0==(r<<=t)&&(i++,r=e<<s)}}*toIteratorPow2(t){this.normalize();const e=(1<<t)-1;let s=0,i=0,r=e;for(;s<this._bits;){const n=(this._avec[i]&r)>>>s,o=(this._bvec[i]&r)>>>s;yield n<<t|o,s+=t,0==(r<<=t)&&(i++,r=e)}}toArray(){this.normalize();let t=0,e=0,s=1,i=[];for(;t<this._bits;){const r=(this._avec[e]&s)>>>t<<1|(this._bvec[e]&s)>>>t;i.push(r-1-Number(r>1)),t+=1,0==(s<<=1)&&(e++,s=1)}return i}toBin(){return b(0,this._bits,this._avec,this._bvec)}toOct(){this.normalize();let t=0,e=0,s=7,i=[];for(;t<this._bits;){let r=(this._avec[e]&s)>>>t,n=(this._bvec[e]&s)>>>t;if(s>>>t!=7&&e+1!=this._avec.length){const s=7>>-t;r|=(this._avec[e+1]&s)<<-t,n|=(this._bvec[e+1]&s)<<-t}const o=r<<3|n;7&o&~(o>>3)?i.push("x"):i.push((o>>3).toString()),t+=3,0==(s<<=3)&&(e++,s=7<<t)}return i.reverse().join("")}toHex(){return u(0,this._bits,this._avec,this._bvec)}toString(){return"Vector3vl "+this.toBin()}eq(t){if(t._bits!=this._bits)return!1;this.normalize(),t.normalize();for(const e in this._avec){if(this._avec[e]!=t._avec[e])return!1;if(this._bvec[e]!=t._bvec[e])return!1}return!0}normalize(){const t=this._lastmask;this._avec[this._avec.length-1]&=t,this._bvec[this._bvec.length-1]&=t}get _lastmask(){return-1>>>-this.bits}}g.empty=g.zeros(0),g.one=g.ones(1),g.zero=g.zeros(1),g.x=g.xes(1),e.Vector3vl=g;class p{constructor(t,e,s){void 0===s&&(s=0),this._bits=0|t,this._size=0|e,this._wpc=(t+31)/32|0,this._avec=new Uint32Array(e*this._wpc).fill(s>0?-1:0),this._bvec=new Uint32Array(e*this._wpc).fill(s>=0?-1:0),this._size&&this.set(this._size-1,this.get(this._size-1))}static fromData(t){if(0==t.length)return new p(0,0);const e=new p(t[0].bits,t.length);for(const s in t){t[s].normalize(),console.assert(t[s].bits==e._bits);for(let i=0;i<e._wpc;i++){const r=Number(s)*e._wpc+i;e._avec[r]=t[s]._avec[i],e._bvec[r]=t[s]._bvec[i]}}return e}get bits(){return this._bits}get words(){return this._size}get(t){const e=this._wpc*t;return new g(this._bits,this._avec.slice(e,e+this._wpc),this._bvec.slice(e,e+this._wpc))}set(t,e){console.assert(e.bits==this._bits),e.normalize();for(let s=0;s<this._wpc;s++)this._avec[t*this._wpc+s]=e._avec[s],this._bvec[t*this._wpc+s]=e._bvec[s]}toJSON(){const t=[];let e,s=[],i=0;const r=()=>{if(0!=s.length){if(s.reduce((t,e)=>t+e.length,0)==this._bits){const e=s.pop();s.length>0&&t.push(s.join("")),t.push(e)}else t.push(s.join(""));s=[]}},n=()=>{0!=i&&(1==i?e.length==this._bits?(r(),t.push(e)):s.push(e):(r(),t.push(i),t.push(e)),e=void 0,i=0)},o=t=>{e==t?i++:(n(),e=t,i=1)};for(let t=0;t<this._size;t++){const e=()=>{for(let e=0;e<this._wpc;e++){const s=this._avec[t*this._wpc+e]^this._bvec[t*this._wpc+e];for(let t=0;t<4;t++){const e=255<<16*t,i=s&e;if(i!=e||0!=i)return!1}}return!0};this._bits>0&&e()?o(u(t*this._wpc,this._bits,this._avec,this._bvec)):o(b(t*this._wpc,this._bits,this._avec,this._bvec))}return n(),r(),t}static fromJSON(t,e){const s=Math.ceil(t/4);let i=0;const r=e=>e.length==t||e.length==s?1:e.length/s;for(let t=0;t<e.length;t++)"string"==typeof e[t]?i+=r(e[t]):"number"==typeof e[t]&&(i+=e[t]*r(e[t+1]),t++);const n=new p(t,i,-1);let o=0;const c=e=>{if(e.length==t)f(e,o,t,n._avec,n._bvec),o+=n._wpc;else if(e.length==s)v(e,o,t,n._avec,n._bvec),o+=n._wpc;else for(let i=0;i<e.length/s;i++)v(e.slice(i*s,(i+1)*s),o,t,n._avec,n._bvec),o+=n._wpc};for(let t=0;t<e.length;t++)if("string"==typeof e[t])c(e[t]);else if("number"==typeof e[t]){for(const s of Array(e[t]).keys())c(e[t+1]);t++}return n}toArray(){return Array(this._size).fill(0).map((t,e)=>this.get(e))}toHex(){return this.toArray().map(t=>t.toHex())}eq(t){if(t._bits!=this._bits||t._size!=this._size)return!1;for(let e=0;e<this._size;e++)if(!t.get(e).eq(this.get(e)))return!1;return!0}}e.Mem3vl=p}])});
//# sourceMappingURL=wavecanvas.js.map